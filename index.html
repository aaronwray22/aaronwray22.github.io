<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-rc4/vega.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.10/vega-lite.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.19/vega-embed.js"></script>
    <script src="data.js"></script>
</head>
<body>

<div class="container">
    <h1 id="title">The Impact of Falling Costs on Solar Adoption</h1>
    <div id="viz"></div><br />
    <div class="dropdown">
        <!--<p style="font-size: 18px; font-style: italic">Select Segment of Use</p>-->
        <button class="btn btn-secondary dropdown-toggle" type="button" id="segmentdropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Click here to select a Segment of Use to view the sost/system size interactions.
        </button>
        <div id="segmentlist" class="dropdown-menu" aria-labelledby="segmentdropdown">
            <a class="dropdown-item" href="#">Residential</a>
            <a class="dropdown-item" href="#">Commercial</a>
            <a class="dropdown-item" href="#">Government</a>
            <a class="dropdown-item" href="#">Unknown/Other</a>
        </div>
    </div>
    <div id="viz2"></div>
</div>
<script type="text/javascript">
    var selectedsegment = 'Residential';
    $('#segmentlist').on('click', 'a', function () {
        selectedsegment = $(this).text();
        $('#segmentdropdown').text($(this).text());
        updatevis(selectedsegment);
    });
    var d =
        {
            "$schema": "https://vega.github.io/schema/vega-lite/v2.json",
            "width": 300, "height": 200,
            "data": {
                "url": "https://aaronwray22.github.io/pv.csv"
            },
            "mark": "area",
            "encoding": {
                "x": {
                    "timeUnit": "year", "field": "Date Installed", "type": "temporal",
                    "scale": { "nice": "year" },
                    "axis": { "domain": false, "format": "%Y", "labelAngle": 0, "tickSize": 0 }
                },
                "y": {
                    "aggregate": "sum", "field": "KWH Production", "type": "quantitative",
                    "axis": null,
                    "stack": "center"
                },
                "color": { "field": "Segment of Use", "type": "nominal", "scale": { "scheme": "tableau10" } }
            }
        }

    vega.embed('#viz', d);
   function updatevis (selection) {


    var d2 = {
        "$schema": "https://vega.github.io/schema/vega-lite/v2.json",
        "data": {
            "url": "https://aaronwray22.github.io/pv.csv"
        },
        "layer": [
            {
                "transform": [
                    { "filter": { "field": "Segment of Use", "equal": selection } }
                ],
                "mark": "line",
                "encoding": {
                    "x": {
                        "timeUnit": "year",
                        "field": "Date Installed",
                        "type": "temporal"
                    },
                    "y": {
                        "aggregate": "mean",
                        "field": "Cost Per Watt",
                        "type": "quantitative",
                        "axis": {
                            "grid": false
                        }
                    }
                }
            },
            {
                "transform": [
                    { "filter": { "field": "Segment of Use", "equal": selection } }
                ],
                "mark": "line",
                "encoding": {
                    "x": {
                        "timeUnit": "year",
                        "field": "Date Installed",
                        "type": "temporal"
                    },
                    "y": {
                        "aggregate": "mean",
                        "field": "Avg System KW",
                        "type": "quantitative",
                        "axis": {
                            "grid": false
                        },
                        "scale": {
                            "zero": false
                        }
                    },
                    "color": {
                        "value": "darkorange"
                    }
                }
            }
        ],
        "resolve": {
            "y": {
                "scale": "independent",
                "axis": "independent"
            },
            "x": {
                "scale": "shared",
                "axis": "shared"
            }
        }
    }
    vega.embed('#viz2', d2);

    };
    //$(document).ready(function () {
    //    updatevis;
    //});
</script>
</body>

</html>